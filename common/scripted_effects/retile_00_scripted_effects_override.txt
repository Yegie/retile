create_fe_home_citadel = {
	create_starbase = {
		size = "starbase_citadel"

		building = "target_uplink_computer"
		building = "defense_grid"
		building = "colossus_yards"
		building = "titan_yards"
		
		module = "shipyard"
		module = "shipyard"
		module = "shipyard"			
		module = "hangar_bay"
		module = "gun_battery"
		module = "gun_battery"		

		effect = {
			while = {
				count = 10
				create_fallen_empire_platform = yes
			}	
		}
	}
}

create_fe_citadel = {
	create_starbase = {
		size = "starbase_citadel"

		building = "crew_quarters"
		building = "command_center"
		building = "target_uplink_computer"
		building = "listening_post"
		
		module = "shipyard"
		module = "anchorage"
		module = "anchorage"
		module = "hangar_bay"
		module = "gun_battery"
		#module = "gun_battery"

		effect = {
			while = {
				count = 4
				create_fallen_empire_platform = yes
			}	
		}			
	}
}

create_fe_fringe_colony = {
	set_planet_flag = fallen_empire_world
	prevent_anomaly = yes
	set_owner = ROOT

	add_building = building_ancient_palace		# 6 precursors
	add_building = building_class_4_singularity # 16 custodians
	add_building = building_nano_forge
	add_building = building_fe_dome
	
	while = {
		count = 12	# 48 precursors
		add_district = district_city
	}
	add_deposit = retile_deposit_preserve	# 10 custodians
	add_deposit = retile_deposit_preserve
	while = {
		count = 54
		create_pop = {
			species = owner_main_species
		}
	}
	while = {
		count = 26
		create_pop = {
			species = event_target:fe_servants
		}
	}
}

create_fe_spiritualist_fringe_colony = {
	set_planet_flag = fallen_empire_world
	prevent_anomaly = yes
	set_owner = ROOT
	add_building = building_ancient_palace		# 6 precursors
	add_building = building_class_4_singularity # 16 custodians
	add_building = building_nano_forge
	add_building = building_fe_dome
	
	while = {
		count = 12	# 48 precursors
		add_district = district_city
	}
	add_deposit = retile_deposit_preserve	# 10 custodians
	add_deposit = retile_deposit_preserve
	while = {
		count = 80
		create_pop = {
			species = owner_main_species
		}
	}
}

# Change planet class one step up in temperature
increase_planet_temperature = {
	if = {
		limit = { is_planet_class = pc_barren }
		change_pc = pc_molten
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_desert }
		change_pc = pc_molten
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_arid }
		change_pc = pc_barren
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_savannah }
		change_pc = pc_barren
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_ocean }
		change_pc = pc_desert
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_continental }
		change_pc = pc_arid
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_tropical }
		change_pc = pc_savannah
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_arctic }
		change_pc = pc_ocean
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_alpine }
		change_pc = pc_continental
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_tundra }
		change_pc = pc_tropical
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_barren_cold }
		change_pc = pc_tundra
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_frozen }
		change_pc = pc_arctic
		reroll_planet = yes
		retile_clear_blockers = yes
	}
}

# Change planet class one step down in temperature
decrease_planet_temperature = {
	if = {
		limit = { is_planet_class = pc_molten }
		change_pc = pc_desert
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_barren }
		change_pc = pc_arid
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_desert }
		change_pc = pc_ocean
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_arid }
		change_pc = pc_continental
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_savannah }
		change_pc = pc_tropical
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_ocean }
		change_pc = pc_arctic
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_continental }
		change_pc = pc_alpine
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_tropical }
		change_pc = pc_tundra
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_arctic }
		change_pc = pc_frozen
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_alpine }
		change_pc = pc_frozen
		reroll_planet = yes
		retile_clear_blockers = yes
	}
	else_if = {
		limit = { is_planet_class = pc_tundra }
		random_list = {
			50 = { change_pc = pc_frozen }
			50 = { change_pc = pc_barren_cold }
		}
		reroll_planet = yes
		retile_clear_blockers = yes
	}
}

fire_warning_sign = {
	if = {
		limit = { # trigger from syndaw.401
			host_has_dlc = "Synthetic Dawn Story Pack"
			NOR = {
				has_ethic = ethic_gestalt_consciousness
				has_country_flag = synthetic_empire
				has_ascension_perk = ap_the_flesh_is_weak
				has_policy_flag = ai_full_rights
				has_country_flag = no_machine_uprising
				#has_policy_flag = robots_outlawed
			}
			OR = {
				has_technology = tech_combat_computers_3
				has_technology = tech_synthetic_workers
			}
		}

		random_list = { # 9 warning sign events + 1 uprising
			10 = {
				country_event = {
					id = syndaw.500
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_500
						NOT = { has_technology = tech_administrative_ai }
					}
				}
			}
			10 = {
				country_event = {
					id = syndaw.505
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_505
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								free_housing > 5
								any_owned_pop = {
									NOT = {
										has_trait = trait_mechanical
									}
								}
							}
						}
					}
				}
			}
			10 = {
				country_event = {
					id = syndaw.510
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_510
						NOT = { any_owned_ship = { is_ship_size = mining_station } }
					}
				}
			}
			10 = {
				country_event = {
					id = syndaw.515
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_515
						NOR = {
							has_technology = tech_rare_crystals
							has_technology = tech_volatile_motes
							has_technology = tech_exotic_gases
							has_technology = tech_mine_living_metal
							has_technology = tech_mine_zro
							has_technology = tech_mine_dark_matter
							has_technology = tech_terrestrial_sculpting
						}
					}
				}
			}
			10 = {
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						any_owned_pop = { has_job = researcher }
					}
					planet_event = {
						id = syndaw.520
						days = 180 random = 720
					}
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_520
						NOT = { 
							any_owned_planet = {
								any_owned_pop = { has_job = researcher }							
							}
						}
					}
				}
			}
			10 = {
				country_event = {
					id = syndaw.525
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_525
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								any_owned_pop = { has_trait = trait_mechanical }
							}
						}
					}
				}
			}
			10 = {
				country_event = {
					id = syndaw.530
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_530
						is_at_war = yes
						NOR = {
							has_technology = tech_combat_computers_1
							any_owned_fleet = {
								is_in_combat = no
								count_fleet_ships = {
									count > 1
									limit = {
										OR = {
											is_ship_size = corvette
											is_ship_size = destroyer
											is_ship_size = cruiser
										}
									}
								}
							}
						}
					}
				}
			}
			10 = {
				country_event = { id = syndaw.535 }
				modifier = {
					factor = 0
					has_country_flag = triggered_syndaw_535
				}
			}
			10 = {
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						OR = {
							any_owned_pop = {
								has_trait = trait_mechanical
							}
							owner = {
								any_owned_army = {
									exists = planet
									planet = { is_same_value = root }
									OR = {
										army_type = robotic_army
										army_type = robotic_defense_army
									}
								}
							}
						}
					}
					planet_event = {
						id = syndaw.540
						days = 180 random = 720
					}
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_540
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								OR = {
									any_owned_pop = {
										has_trait = trait_mechanical
									}
									owner = {
										any_owned_army = {
											exists = planet
											planet = { is_same_value = root }
											OR = {
												army_type = robotic_army
												army_type = robotic_defense_army
											}
										}
									}
								}
							}
						}
					}
				}
			}
			10 = { # does this unit have a soul
				random_owned_planet = {
					limit = {
						is_occupied_flag = no
						any_owned_pop = {
							has_trait = trait_mechanical
						}
					}
					planet_event = {
						id = syndaw.545
						days = 180 random = 720
					}
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_545
						NOT = {
							any_owned_planet = {
								is_occupied_flag = no
								any_owned_pop = {
									has_trait = trait_mechanical
								}
							}
						}
					}
				}
			}
			1 = { # patch the uprising
				country_event = {
					id = syndaw.550
					days = 180 random = 720
				}
				modifier = {
					factor = 0
					OR = {
						has_country_flag = triggered_syndaw_550
						NOR = {
							has_country_flag = triggered_syndaw_500
							has_country_flag = triggered_syndaw_505
							has_country_flag = triggered_syndaw_515
							has_country_flag = triggered_syndaw_520
							has_country_flag = triggered_syndaw_525
							has_country_flag = triggered_syndaw_530
							has_country_flag = triggered_syndaw_535
							has_country_flag = triggered_syndaw_540
							has_country_flag = triggered_syndaw_545
						}
					}
				}
			}
			1 = { # machine uprising
				country_event = {
					id = syndaw.1000
					days = 180 random = 720
				}
			}
		}
	}
}
